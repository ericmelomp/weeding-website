<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Lista de presentes - Casamento de Suzana & Eric - 10 de abril de 2027">
    <title>Lista de Presentes - Suzana & Eric</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Inter:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        .filtros-preco {
            margin: var(--spacing-lg) 0;
            padding: var(--spacing-md);
            background: rgba(200, 164, 93, 0.05);
            border-radius: 8px;
        }

        .filtros-label {
            font-family: var(--font-sans);
            font-size: 1rem;
            color: var(--color-text);
            margin-bottom: var(--spacing-sm);
            font-weight: 500;
        }

        .filtros-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-xs);
        }

        .filtro-btn {
            padding: 0.6rem 1.2rem;
            font-family: var(--font-sans);
            font-size: 0.9rem;
            background: white;
            border: 1px solid var(--color-gold-border);
            border-radius: 4px;
            color: var(--color-text);
            cursor: pointer;
            transition: var(--transition);
        }

        .filtro-btn:hover {
            border-color: var(--color-gold);
            background: var(--color-gold-light);
        }

        .filtro-btn.active {
            background: var(--color-gold);
            color: white;
            border-color: var(--color-gold);
        }

        @media (max-width: 768px) {
            .filtros-buttons {
                flex-direction: column;
            }

            .filtro-btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-container">
            <a href="/" class="logo-link">
                <img src="assets/logobrasao.png" alt="Suzana & Eric" class="logo-img" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                <div class="logo-placeholder">SE</div>
            </a>
            <nav class="nav">
                <a href="/" class="nav-link">Voltar para o site</a>
            </nav>
        </div>
    </header>

    <main class="presentes-page">
        <div class="container">
            <div class="section-header">
                <h1 class="section-title">Lista de presentes</h1>
                <div class="section-divider"></div>
                <p class="presentes-observacao">Esta lista serve apenas como refer√™ncia. Aceitaremos de bom grado qualquer item ou valor que desejarem nos oferecer. O que realmente importa √© celebrar este momento especial ao lado de quem amamos.</p>
            </div>

            <div class="filtros-preco">
                <p class="filtros-label">Filtrar por faixa de pre√ßo:</p>
                <div class="filtros-buttons">
                    <button class="filtro-btn" data-faixa="all" onclick="filtrarPorPreco('all')">Todos</button>
                    <button class="filtro-btn" data-faixa="0-50" onclick="filtrarPorPreco('0-50')">At√© R$50</button>
                    <button class="filtro-btn" data-faixa="50-150" onclick="filtrarPorPreco('50-150')">R$50 - R$150</button>
                    <button class="filtro-btn" data-faixa="150-400" onclick="filtrarPorPreco('150-400')">R$150 - R$400</button>
                    <button class="filtro-btn" data-faixa="400-800" onclick="filtrarPorPreco('400-800')">R$400 - R$800</button>
                    <button class="filtro-btn" data-faixa="800-1000" onclick="filtrarPorPreco('800-1000')">R$800 - R$1.000</button>
                    <button class="filtro-btn" data-faixa="1000+" onclick="filtrarPorPreco('1000+')">R$1.000+</button>
                </div>
            </div>

            <div class="presentes-grid" id="presentesGrid">
                <!-- Os presentes ser√£o carregados dinamicamente via JavaScript -->
            </div>
        </div>
    </main>

    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <img src="assets/logobrasao.png" alt="Suzana & Eric" class="footer-logo-img" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                <div class="footer-logo">SE</div>
                <p class="footer-text">Suzana & Eric ‚Äî 10 de abril de 2027</p>
            </div>
        </div>
    </footer>

    <script src="script.js"></script>
    <script>
        let pixCodeGlobal = '00020126660014BR.GOV.BCB.PIX0111431773188670229Agradecemos demais sua ajuda!5204000053039865802BR5917ERIC MELO PEREIRA6004MAUA62250521lS73N0fDqHaow3D7KcYx8630459FF';
        let todosPresentes = [];
        let filtroAtual = 'all';
        
        // Carrega os presentes do JSON ou localStorage
        async function loadPresentes() {
            try {
                let presentesData = [];
                
                // Tenta carregar do localStorage primeiro (para desenvolvimento/teste no mesmo dom√≠nio)
                const saved = localStorage.getItem('presentesAdminData');
                if (saved) {
                    try {
                        presentesData = JSON.parse(saved);
                        todosPresentes = presentesData;
                        filtrarPorPreco(filtroAtual);
                        return; // Se conseguiu carregar do localStorage, n√£o precisa buscar do JSON
                    } catch (e) {
                        console.warn('Erro ao ler localStorage, usando JSON:', e);
                    }
                }
                
                // Se n√£o houver no localStorage, carrega do arquivo JSON
                const response = await fetch('presentes-data.json?t=' + Date.now());
                if (response.ok) {
                    presentesData = await response.json();
                } else {
                    console.error('Erro ao carregar presentes-data.json');
                    return;
                }
                
                todosPresentes = presentesData;
                filtrarPorPreco(filtroAtual);
            } catch (error) {
                console.error('Erro ao carregar presentes:', error);
            }
        }
        
        // Filtra presentes por faixa de pre√ßo
        function filtrarPorPreco(faixa) {
            filtroAtual = faixa;
            
            // Atualiza bot√µes ativos
            document.querySelectorAll('.filtro-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.getAttribute('data-faixa') === faixa) {
                    btn.classList.add('active');
                }
            });
            
            let presentesFiltrados = [];
            
            // Separa presentes PIX dos demais
            const presentesPix = todosPresentes.filter(p => p.tipo === 'pix');
            const presentesNormais = todosPresentes.filter(p => p.tipo !== 'pix');
            
            if (faixa === 'all') {
                presentesFiltrados = todosPresentes;
            } else {
                // Filtra apenas os presentes normais por pre√ßo
                const normaisFiltrados = presentesNormais.filter(presente => {
                    const preco = presente.preco || 0;
                    
                    switch(faixa) {
                        case '0-50':
                            return preco >= 0 && preco <= 50;
                        case '50-150':
                            return preco > 50 && preco <= 150;
                        case '150-400':
                            return preco > 150 && preco <= 400;
                        case '400-800':
                            return preco > 400 && preco <= 800;
                        case '800-1000':
                            return preco > 800 && preco <= 1000;
                        case '1000+':
                            return preco > 1000;
                        default:
                            return true;
                    }
                });
                
                // Sempre inclui os presentes PIX, independentemente do filtro
                presentesFiltrados = [...presentesPix, ...normaisFiltrados];
            }
            
            renderPresentes(presentesFiltrados);
        }
        
        // Renderiza os presentes na tela
        function renderPresentes(presentesData) {
            const grid = document.getElementById('presentesGrid');
            grid.innerHTML = '';
            
            if (presentesData.length === 0) {
                grid.innerHTML = '<p style="text-align: center; grid-column: 1 / -1; color: var(--color-text-light); padding: var(--spacing-xl);">Nenhum presente encontrado nesta faixa de pre√ßo.</p>';
                return;
            }
            
            presentesData.forEach((presente) => {
                const card = createPresenteCard(presente);
                grid.appendChild(card);
            });
        }
        
        // Cria um card de presente
        function createPresenteCard(presente) {
            const card = document.createElement('div');
            card.className = 'presente-item';
            if (presente.preco) {
                card.setAttribute('data-preco', presente.preco);
            }
            
            const tipo = presente.tipo || 'normal';
            const isPix = tipo === 'pix';
            
            if (isPix && presente.pixCode) {
                pixCodeGlobal = presente.pixCode;
            }
            
            const temImagem = presente.imagem && presente.imagem.trim() !== '';
            
            let imageHTML = '';
            if (temImagem) {
                imageHTML = `<img src="${presente.imagem}" alt="${presente.titulo || ''}" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                    <div class="presente-placeholder" style="display:none;">SE</div>`;
            } else {
                imageHTML = `<div class="presente-placeholder" style="display:flex;">SE</div>`;
            }
            
            let contentHTML = `
                <div class="presente-image">
                    ${imageHTML}
                </div>
                <div class="presente-content">
                    ${presente.titulo ? `<h3 class="presente-title">${presente.titulo}</h3>` : ''}
            `;
            
            if (isPix) {
                contentHTML += `
                    <p class="pix-message" style="font-family: var(--font-sans); font-size: 0.95rem; color: var(--color-text-light); margin-bottom: var(--spacing-md); line-height: 1.6;">
                        ${presente.mensagem || 'Se preferir, voc√™ tamb√©m pode contribuir com qualquer valor via PIX. Ser√° uma ajuda muito especial para come√ßarmos nossa vida a dois!'}
                    </p>
                    <button class="btn btn-primary btn-small" onclick="copyPixCode()">
                        Copiar c√≥digo PIX
                    </button>
                    <p class="pix-copied-message" id="pixCopiedMessage" style="display: none; margin-top: 0.5rem; color: var(--color-gold); font-size: 0.9rem;">
                        C√≥digo copiado! üíõ
                    </p>
                `;
            } else if (presente.link) {
                contentHTML += `
                    <a href="${presente.link}" class="btn btn-primary btn-small" target="_blank" rel="noopener noreferrer">
                        Acessar link
                    </a>
                `;
            }
            
            contentHTML += `
                </div>
            `;
            
            card.innerHTML = contentHTML;
            return card;
        }
        
        function copyPixCode() {
            const pixCode = pixCodeGlobal;
            
            // Tenta usar a API moderna de clipboard
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(pixCode).then(() => {
                    showCopiedMessage();
                }).catch(() => {
                    fallbackCopy(pixCode);
                });
            } else {
                // Fallback para navegadores mais antigos
                fallbackCopy(pixCode);
            }
        }
        
        function fallbackCopy(text) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.left = '-999999px';
            document.body.appendChild(textArea);
            textArea.select();
            try {
                document.execCommand('copy');
                showCopiedMessage();
            } catch (err) {
                alert('N√£o foi poss√≠vel copiar. C√≥digo PIX: ' + text);
            }
            document.body.removeChild(textArea);
        }
        
        function showCopiedMessage() {
            const message = document.getElementById('pixCopiedMessage');
            if (message) {
                message.style.display = 'block';
                setTimeout(() => {
                    message.style.display = 'none';
                }, 3000);
            }
        }
        
        // Carrega os presentes quando a p√°gina carrega
        document.addEventListener('DOMContentLoaded', () => {
            loadPresentes();
            // Define o bot√£o "Todos" como ativo por padr√£o
            document.querySelector('.filtro-btn[data-faixa="all"]').classList.add('active');
        });
    </script>
</body>
</html>